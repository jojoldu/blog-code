# 도메인 모델


### 트랜잭션 스크립트

```java
@Transactional
public Reservation reserveShowing(int customerId, int showingId, int audienceCount) {
    1) 데이터 베이스로부터 Movie, Showing, Rule 조회
    2) Showing에 적용할 수 있는 Rule이 존재하는지 확인
    3) if(Rule이 존재하면) {
            Discount를 읽어 할인된 요금계산
       } else {
            Movie의 정가를 이용해 요금 계산
       }
    4) Reservation을 생성해 데이터베이스에 저장
}
```


### 도메인 모델

도메인 모델은 크게 트랜잭션 스크립트 / 도메인 모델 / 테이블 모듈로 3가지가 있다.  


MyBatis 기반의 개발을 오래 해오신 분들이라면 트랜잭션 스크립트 혹은 테이블 모듈 방식이 익숙하다.  

> 물론 JPA로 개발을 해왔다고 해서 도메인 모델 방식을 해왔다고 볼수는 없다.  
> 도구는 도구일뿐이다.  
> ORM이 없으면 도메인 모델 방식을 할 수 없다는 것에 동의할수는 없다.  
> 그럼 메세지큐나 NoSQL 등의 저장소를 쓸때는 도메인 모델 방식을 쓸수없다는 것이나 마찬가지기 때문이다.


도메인 로직은 모두 도메인 모델로, 애플리케이션 로직(트랜잭션, 메세지 발송 등)은 서비스 레이어로 올린다.  

도메인 모델의 단점
* 테이블 데이터와 매핑하기가 어려움
* DB 테이블을 만드는 원칙과 객체를 만드는 원칙은 서로 다름
* DB 테이블 만드는 원칙은 중복 제거
* 객체는 데이터 기반이 아닌, 행위 기반
* 객체 관계 - 임피던스 불일치
객체 패러다임과 관계 패러다임 간의 불일치
이를 해결하기 위해 데이터 매퍼를 사용
객체 모델과 DB 스키마 간의 독립성 유지
ORM이라 하면 객체와 DB간의 매핑
JPA
임피던스 불일치를 해결할 수 있는 실용적인 솔루션
